quarkus:
  application:
    name: account-service

  # HTTP Server
  http:
    port: 8082
    cors:
      origins: http://localhost:3000,http://localhost:4200
      methods: GET,POST,PUT,DELETE,PATCH,OPTIONS
      headers: Content-Type,Authorization,X-Requested-With
      exposed-headers: Location,X-Request-Id
      access-control-max-age: 24H
    auth:
      permission:
        health:
          paths: /health/*,/q/*
          policy: permit
        swagger:
          paths: /swagger-ui/*,/openapi
          policy: permit
        authenticated:
          paths: /api/*
          policy: authenticated

  # PostgreSQL Database
  datasource:
    db-kind: postgresql
    jdbc:
      url: jdbc:postgresql://localhost:5432/vaultstream_accounts
      min-size: 2
      max-size: 10
    username: vaultstream
    password: vaultstream123

  # Hibernate ORM
  hibernate-orm:
    database:
      generation: drop-and-create
    log:
      sql: true
      format-sql: true

  # Flyway Migrations
  flyway:
    migrate-at-start: false
    baseline-on-migrate: true
    locations: classpath:db/migration

  # OIDC Security (Keycloak)
  oidc:
    enabled: true
    auth-server-url: http://localhost:8180/realms/vaultstream
    client-id: account-service
    credentials:
      secret: account-service-secret
    tls:
      verification: none

  # Health & Metrics
  smallrye-health:
    root-path: /health
  micrometer:
    export:
      prometheus:
        path: /metrics

  # OpenAPI
  smallrye-openapi:
    path: /openapi
    info-title: VaultStream Account Service API
    info-version: 1.0.0
    info-description: Account management with CQRS and Event Sourcing

  # OpenTelemetry
  otel:
    enabled: false
    exporter:
      otlp:
        endpoint: http://localhost:4317

  # Logging
  log:
    level: INFO
    category:
      "com.vaultstream":
        level: DEBUG
      "org.hibernate.SQL":
        level: DEBUG
    console:
      format: "%d{yyyy-MM-dd HH:mm:ss} %-5p [%c{2.}] (%t) %s%e%n"
      color: true

# Kafka Configuration
mp:
  messaging:
    incoming:
      customer-events-in:
        connector: smallrye-kafka
        topic: customer-events
        group:
          id: account-service
        value:
          deserializer: org.apache.kafka.common.serialization.StringDeserializer
        auto:
          offset:
            reset: earliest

kafka:
  bootstrap:
    servers: localhost:9092

# Profile-specific configurations
"%dev":
  quarkus:
    hibernate-orm:
      database:
        generation: drop-and-create
    log:
      level: DEBUG
      category:
        "com.vaultstream":
          level: DEBUG

"%prod":
  quarkus:
    hibernate-orm:
      database:
        generation: validate
    log:
      level: WARN
      category:
        "com.vaultstream":
          level: INFO
    oidc:
      enabled: true
