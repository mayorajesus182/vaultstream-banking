# ============================================================
# Test Configuration for Customer Service
# ============================================================

quarkus.application.name=customer-service-test

# HTTP Server
quarkus.http.port=8081
quarkus.http.test-port=0

# H2 In-Memory Database for Unit Tests
%test.quarkus.datasource.db-kind=h2
%test.quarkus.datasource.jdbc.url=jdbc:h2:mem:testdb;DB_CLOSE_DELAY=-1
%test.quarkus.datasource.username=sa
%test.quarkus.datasource.password=
%test.quarkus.hibernate-orm.database.generation=drop-and-create
%test.quarkus.hibernate-orm.log.sql=false

# Disable Flyway for unit tests (use schema generation)
%test.quarkus.flyway.migrate-at-start=false

# Kafka configuration for tests (overridden by TestContainers)
%test.kafka.bootstrap.servers=localhost:19092
%test.mp.messaging.outgoing.customer-events-out.connector=smallrye-in-memory
%test.mp.messaging.outgoing.customer-events-out.broadcast=true

# Disable OIDC for tests
%test.quarkus.oidc.enabled=false

# Health checks for tests
%test.quarkus.health.extensions.enabled=false

# Security for tests - Override authenticated policy to permit all
%test.quarkus.http.auth.permission.authenticated.policy=permit

# Cache configuration for tests
# Disable Dev Services to avoid Docker issues, use local running Redis
%test.quarkus.redis.devservices.enabled=false
# Connect to local Redis started via docker-compose
%test.quarkus.redis.hosts=redis://localhost:6379

# Rate limiting test configuration
%test.vaultstream.rate-limit.requests=10
%test.vaultstream.rate-limit.window-seconds=60

# Logging for tests
%test.quarkus.log.level=INFO
%test.quarkus.log.category."com.vaultstream".level=DEBUG
%test.quarkus.log.console.format=%d{HH:mm:ss} %-5p [%c{2.}] %s%e%n

# Test data configuration
%test.quarkus.test.continuous-testing=disabled
